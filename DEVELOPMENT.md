# Development

## Business logic
Our RIESGOS business model consists of `processes` and `products`. They form a directed, bipartite graph: each process provides one or more products, which may or may not be the input to another process. We arrange that graph in a linear sequence by running a `toposort` on it. This linear sequence is then displayed in the UI: by arranging the processes in a sequence, we make it easier to guide the user through the chain of steps necessary to simulate a full scenario.


## Getting started
This project depends on the 'UKIS frontend libraries', which are distributed as packages on github. To use these packages, please follow the instructions on [the UKIS frontend libraries github page](https://github.com/dlr-eoc/ukis-frontend-libraries).


### Integrating a WPS into a scenario
Adding a WPS into an existing scenario is a three step process. 

#### Creating the service: Implementing the Process-Interface
Any WPS must be represented by a class implementing the `Process` interface. 
Very often, you will want to extend the `WpsProcess` class: this is a class implementing the `Process` interface that already has the method `execute` implemented for you. Additionally, if you want the service to be visible in the UI, implement the interface `WizardableProcess`.
```
export class VulnerabilityModel extends WpsProcess implements WizardableProcess {
```
If your process'es `execute` method needs to do more than just send an execute-request to a WPS, implement the interface `ExecutableProcess`. Doing this makes sense for example when you need to change your input-parameters names or values before sending them off to the WPS.
```
export class EqDeus implements ExecutableProcess, WizardableProcess {
```

#### Creating the products: Implementing the Product-Interface
A `product` is an object implementing the `Product` interface. Usually your products will come from and be sent to a WPS: in this case, they are `WpsData`.
If you do not want the WPS to return to you the actual data but merely a link to the data's location on the server, set `reference: true`.
```
export const eqUpdatedExposureRef: WpsData & Product = {
    uid: 'updated_exposure_ref',
    description: {
        id: 'updated_exposure',
        reference: true,
        ...
    },
    value: null
};
```

#### Registering service and products in the scenario
Finally, for your service to be integrated into a scenario, it must be listed in the scenario's list of processes (and products).
```
        switch (scenario) {
            case 'c1':
                processes = [
                    new ExposureSelection(this.httpClient),
                    new QuakeLedger(this.httpClient),
                    ...
                ];
                products = [
                    modelChoice,
                    lonmin, lonmax, latmin, latmax, assettype, schema, querymode,
                    assetcategory, losscategory, taxonomies,
                    ...
                ];
                break;
```

### Licenses
3rd party licenses are displayed with the component 'licenses.component'. This component requires there to be a file named 'licenses.json' in the assets directory. 
This file has been autogenerated with the 'license-checker' npm-module. When new dependencies are added, the file needs to be regenerated manually.